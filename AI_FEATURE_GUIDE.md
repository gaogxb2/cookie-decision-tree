# 🤖 AI增强功能使用指南

## 功能概述

AI增强功能允许您通过输入聊天记录，自动分析并生成决策树节点，然后合并到现有的决策树中。

## 启动服务

### 1. 启动后端服务
```bash
source ~/.bash_profile && conda activate py310 && python api_server.py
```

### 2. 启动前端服务
```bash
cd web_editor_vue && npm run dev
```

### 3. 访问界面
- 前端界面: http://localhost:3003/
- 后端API: http://localhost:5000/

## 使用步骤

### 1. 打开决策树编辑器
在浏览器中访问 http://localhost:3003/

### 2. 切换到AI增强标签页
在右侧面板中，点击 "🤖 AI增强" 标签页

### 3. 输入聊天记录
在文本框中输入客服与用户的对话记录，例如：

```
用户: 我的电脑无法连接网络了
客服: 请问是WiFi还是有线连接？
用户: WiFi连接
客服: 请检查WiFi开关是否打开
用户: 开关是打开的
客服: 请尝试重启路由器
用户: 重启后还是不行
客服: 请检查网络适配器驱动是否正常
用户: 怎么检查？
客服: 在设备管理器中查看网络适配器是否有感叹号
用户: 有感叹号，显示驱动有问题
客服: 请更新或重新安装网络适配器驱动
用户: 更新后可以连接了，谢谢
```

### 4. 开始AI分析
点击 "直接AI分析" 按钮，系统将：
- 调用AI API解析聊天记录
- 提取问题定位路径
- 转换为决策树节点结构
- 显示分析结果

### 5. 查看分析结果
AI分析完成后，您将看到：
- **解析的路径**: 显示从聊天记录中提取的问题、步骤和解决方案
- **变更列表**: 显示新增或修改的节点
- **新节点预览**: 显示生成的决策树节点结构

### 6. 确认并合并
点击 "确认并合并" 按钮，将AI生成的节点合并到现有决策树中。

## 功能特点

### ✅ 智能解析
- 自动从聊天记录中提取问题定位路径
- 识别问题、诊断步骤和解决方案
- 严格按照聊天记录内容，不添加额外信息

### ✅ 路径转换
- 将线性对话路径转换为决策树节点结构
- 自动生成节点ID和连接关系
- 保持对话的逻辑顺序

### ✅ 安全合并
- 预览模式：先查看分析结果，再决定是否合并
- 自动模式：直接合并到决策树
- 避免重复节点，智能处理冲突

### ✅ 可视化预览
- 实时显示解析的路径步骤
- 预览生成的节点结构
- 清晰的变更列表

## 技术架构

### 后端API
- `/api/ai/direct-process`: 直接调用AI API处理聊天记录
- 支持预览模式和自动合并模式
- 返回结构化的分析结果

### 前端组件
- `AIAugmentPanel.vue`: AI增强面板组件
- 集成到主编辑器界面
- 提供直观的用户交互

### AI处理流程
1. **聊天记录解析**: 使用AI提取问题定位路径
2. **路径转换**: 将线性路径转换为决策树节点
3. **节点合并**: 将新节点合并到现有决策树
4. **结果保存**: 更新决策树配置文件

## 配置说明

### AI API配置
- 配置文件: `config/ai_config.yaml`
- 支持多种AI服务: Dashscope、OpenAI、Azure等
- 环境变量: `DASHSCOPE_API_KEY`

### 提示词配置
- 配置文件: `config/prompts.yaml`
- 可自定义AI解析提示词
- 支持严格的内容控制

## 测试验证

运行测试脚本验证功能：
```bash
python test_frontend_ai.py
```

## 注意事项

1. **环境要求**: 确保使用 `py310` conda环境
2. **API密钥**: 需要配置有效的AI API密钥
3. **网络连接**: 需要稳定的网络连接访问AI服务
4. **数据备份**: 建议在合并前备份决策树文件

## 故障排除

### 常见问题

1. **AI解析失败**
   - 检查API密钥配置
   - 确认网络连接
   - 查看后端日志

2. **前端无法访问**
   - 确认前端服务运行在正确端口
   - 检查防火墙设置

3. **合并失败**
   - 检查决策树文件权限
   - 确认文件格式正确

### 调试方法

1. 查看后端日志
2. 使用浏览器开发者工具
3. 运行测试脚本验证功能

## 更新日志

- **v1.0**: 初始版本，支持基本的AI解析和合并功能
- **v1.1**: 优化AI提示词，提高解析准确性
- **v1.2**: 添加直接AI调用功能，提升处理速度 