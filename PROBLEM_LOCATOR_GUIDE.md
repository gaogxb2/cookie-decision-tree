# [DEBUG] 问题定位器使用指南

## 概述

问题定位器是一个基于决策树的智能诊断系统，能够根据用户的输入自动匹配YAML配置文件中的选项，逐步定位问题并提供解决方案。

## 功能特点

### 智能匹配
- **数字匹配**: 直接输入选项编号
- **文本匹配**: 输入关键词或完整文本
- **模糊匹配**: 支持部分匹配和相似度计算
- **容错处理**: 自动处理输入错误和格式问题

### 诊断功能
- **逐步定位**: 根据用户回答逐步缩小问题范围
- **路径记录**: 自动记录诊断路径
- **返回功能**: 支持返回上一步重新选择
- **重新开始**: 可以随时重新开始诊断

### 用户体验
- **友好界面**: 清晰的提示和选项显示
- **实时反馈**: 立即显示匹配结果
- **错误处理**: 完善的错误提示和恢复机制

## 快速开始

### 1. 启动方式

#### macOS / Linux
```bash
./start_locator.sh
```

#### Windows
```cmd
start_locator.bat
```

#### 直接运行
```bash
python problem_locator.py
```

### 2. 基本使用

1. **启动系统**: 运行启动脚本
2. **回答问题**: 根据提示选择或输入答案
3. **查看结果**: 系统会显示最终的解决方案
4. **查看路径**: 可以查看完整的诊断路径

## 详细功能

### 输入方式

#### 数字输入
```
请输入您的选择: 1
```

#### 文本输入
```
请输入您的选择: 硬件问题
```

#### 关键词输入
```
请输入您的选择: 硬件
```

### 特殊命令

| 命令 | 功能 | 示例 |
|------|------|------|
| `quit` / `exit` / `q` | 退出系统 | `quit` |
| `restart` / `r` | 重新开始诊断 | `restart` |
| `path` / `p` | 查看诊断路径 | `path` |
| `back` / `b` | 返回上一步 | `back` |

### 匹配算法

#### 完全匹配
- 用户输入与选项文本完全一致
- 匹配度: 100%

#### 包含匹配
- 用户输入包含在选项文本中，或反之
- 匹配度: 80%

#### 关键词匹配
- 基于词汇交集计算相似度
- 匹配度: 0-100%（根据词汇重叠程度）

#### 匹配阈值
- 最低匹配度: 30%
- 低于此阈值将提示重新输入

## 配置文件格式

问题定位器使用YAML格式的配置文件，结构如下：

```yaml
decision_tree:
  root_node: start
  nodes:
    start:
      question: "您遇到了什么类型的问题？"
      options:
        - text: "硬件问题"
          next_node: hardware_issue
        - text: "软件问题"
          next_node: software_issue
    
    hardware_issue:
      question: "硬件问题具体是什么？"
      options:
        - text: "显示器问题"
          next_node: display_issue
        - text: "键盘问题"
          next_node: keyboard_issue
    
    display_issue:
      solution: "检查显示器连接线，尝试重新插拔。"
```

### 节点类型

#### 决策节点
- 包含 `question` 和 `options`
- 用于询问用户并获取选择

#### 解决方案节点
- 包含 `solution`
- 提供最终的问题解决方案

## 高级功能

### 诊断路径记录

系统会自动记录用户的诊断路径：

```
诊断路径:
----------------------------------------
1. 硬件问题
2. 显示器问题
----------------------------------------
```

### 返回功能

用户可以返回上一步重新选择：

```
请输入您的选择: back
已返回上一步: 显示器问题
```

### 错误处理

#### 输入错误
```
[ERROR] 无法匹配您的输入，请重新选择
```

#### 配置文件错误
```
[ERROR] 错误: 找不到节点 'invalid_node'
```

#### 系统错误
```
[ERROR] 发生错误: [错误详情]
```

## 自定义配置

### 修改匹配阈值

在 `problem_locator.py` 中修改：

```python
# 设置匹配阈值
if best_score >= 0.3:  # 30%的匹配度
    return best_match
```

### 添加新的匹配算法

在 `_fuzzy_match` 方法中添加新的匹配逻辑：

```python
def _fuzzy_match(self, user_input: str, option_text: str) -> float:
    # 现有匹配逻辑...
    
    # 添加新的匹配算法
    # 例如：拼音匹配、同义词匹配等
    
    return score
```

## 故障排除

### 常见问题

#### Q: 配置文件加载失败
A: 检查文件路径和YAML格式是否正确

#### Q: 匹配不准确
A: 调整匹配阈值或改进输入文本

#### Q: 无法返回上一步
A: 检查节点配置中的 `next_node` 引用是否正确

#### Q: 系统启动失败
A: 检查Python环境和依赖包是否正确安装

### 调试模式

可以添加调试信息来查看匹配过程：

```python
# 在 _find_best_match 方法中添加
print(f"匹配 '{user_input}' 与 '{option['text']}': {score}")
```

## 扩展功能

### 1. 多语言支持
- 添加语言检测
- 支持多语言配置文件
- 国际化界面

### 2. 机器学习增强
- 基于历史数据的智能推荐
- 用户行为分析
- 自动优化匹配算法

### 3. 集成功能
- 与知识库集成
- 支持外部API调用
- 数据统计和分析

### 4. 界面优化
- 图形化界面
- 语音输入支持
- 移动端适配

## 技术架构

### 核心组件

1. **配置加载器**: 负责加载和解析YAML配置
2. **匹配引擎**: 实现多种匹配算法
3. **状态管理器**: 管理当前节点和诊断路径
4. **用户界面**: 处理用户输入和输出

### 数据流

```
用户输入 → 匹配引擎 → 状态更新 → 显示结果
    ↓
配置文件 → 节点信息 → 选项匹配 → 路径记录
```

### 性能优化

- **缓存机制**: 缓存配置文件内容
- **快速匹配**: 优化匹配算法性能
- **内存管理**: 及时释放不需要的数据

## 贡献指南

### 开发环境

1. 克隆项目
2. 安装依赖: `pip install pyyaml`
3. 运行测试: `python problem_locator.py`

### 代码规范

- 使用Python类型注解
- 添加详细的文档字符串
- 遵循PEP 8代码风格
- 编写单元测试

### 提交规范

- `feat`: 新功能
- `fix`: 修复bug
- `docs`: 文档更新
- `refactor`: 代码重构

---

*最后更新: 2024年12月* 